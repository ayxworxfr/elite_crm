# 销售机会管理模块

## 功能概述

销售机会管理模块是一个完整的CRM销售机会管理系统，基于Ant Design Pro构建，提供销售机会的全生命周期管理。

## 主要功能

### 1. 销售机会列表管理
- 分页查询销售机会列表
- 多条件筛选（机会名称、客户、负责人、金额范围、概率范围、状态、阶段、来源、预期日期等）
- 批量操作（删除、状态更新）
- 响应式表格设计

### 2. 销售机会CRUD操作
- **创建**：新建销售机会，包含完整的表单验证
- **查看**：点击机会名称查看详细信息
- **编辑**：修改销售机会信息
- **删除**：支持单个和批量删除

### 3. 状态管理
- **状态流转**：初期接触 → 需求分析 → 方案制定 → 商务谈判 → 签约成交
- **状态推进**：智能状态推进，支持阶段跳转
- **失败处理**：标记失败原因，支持重新激活

### 4. 活动管理
- **活动记录**：添加跟进活动（电话沟通、邮件往来、会议、客户拜访等）
- **时间线展示**：可视化活动历史记录
- **活动提醒**：支持设置活动提醒

### 5. 销售分析
- **销售漏斗**：各阶段机会数量和转化率统计
- **趋势分析**：机会数量、成交金额、转化率趋势
- **销售排行**：销售人员业绩排行
- **预期收入**：基于概率的预期收入预测

### 6. 数据导出
- Excel格式导出
- PDF报告导出
- 自定义筛选条件导出

## 技术特性

### 前端技术栈
- React 18 + TypeScript
- Ant Design Pro Components
- UmiJS 4 框架
- 响应式设计

### 组件架构
```
SalesOpportunityList/
├── index.tsx                 # 主页面
├── components/
│   ├── CreateForm.tsx        # 创建表单
│   ├── UpdateForm.tsx        # 更新表单
│   ├── AddActivityForm.tsx   # 添加活动表单
│   ├── StageAdvanceForm.tsx  # 阶段推进表单
│   ├── SalesAnalytics.tsx    # 销售分析组件
│   └── index.ts             # 组件导出
└── README.md                # 说明文档
```

### 数据模型
基于Go后端的销售机会模型：
- 机会基本信息（名称、客户、负责人、金额、概率等）
- 状态管理（6个状态阶段）
- 活动时间线
- 关联数据（客户、负责人、来源等）

## 使用方法

### 1. 访问模块
在浏览器中访问：`/sales-opportunity`

### 2. 创建销售机会
1. 点击"新建"按钮
2. 填写必要信息（机会名称、客户ID、负责人ID、金额、概率等）
3. 选择初始状态
4. 提交表单

### 3. 管理销售机会
- **编辑**：点击操作列的"编辑"按钮
- **推进阶段**：点击"推进阶段"按钮，选择下一个状态
- **添加活动**：点击"添加活动"按钮，记录跟进情况
- **标记失败**：点击"标记失败"按钮，输入失败原因

### 4. 查看分析报告
1. 点击"销售分析"按钮
2. 选择时间范围和分组方式
3. 查看各类统计图表
4. 导出分析报告

## 业务规则

### 状态流转规则
- 状态只能按顺序推进，不能回退（除非重新激活）
- 已成交的机会不能再推进
- 失败的机会可以重新激活到"初期接触"状态

### 数据验证规则
- 机会金额必须大于0
- 成交概率必须在0-100%之间
- 预期成交日期不能早于当前日期
- 必填字段：机会名称、客户ID、负责人ID、金额、概率、预期成交日期、状态

### 权限控制
- 基于角色的权限控制
- 销售人员只能管理自己的机会
- 销售经理可以管理团队所有机会
- 管理员拥有所有权限

## 配置说明

### 路由配置
在 `config/routes.ts` 中已添加：
```typescript
{
  path: '/sales-opportunity',
  name: 'sales-opportunity',
  icon: 'fund',
  component: './SalesOpportunityList',
}
```

### API接口
所有接口都在 `src/services/ant-design-pro/api.ts` 中定义：
- `getSalesOpportunityList` - 获取列表
- `addSalesOpportunity` - 创建机会
- `updateSalesOpportunity` - 更新机会
- `removeSalesOpportunity` - 删除机会
- `advanceOpportunityStage` - 推进阶段
- `loseOpportunity` - 标记失败
- `addOpportunityActivity` - 添加活动
- `getSalesAnalytics` - 获取分析数据

## 扩展功能

### 待开发功能
1. **审批工作流**：大额机会的审批流程
2. **附件管理**：活动记录的附件上传
3. **邮件集成**：自动发送跟进邮件
4. **移动端适配**：响应式移动端界面
5. **实时通知**：活动提醒和状态变更通知

### 自定义配置
- 状态配置：可自定义状态名称和颜色
- 活动类型：可配置活动类型选项
- 字段配置：可自定义表单字段
- 权限配置：可配置角色权限

## 注意事项

1. **数据安全**：所有操作都有权限验证
2. **性能优化**：大数据量时使用分页加载
3. **错误处理**：完善的错误提示和异常处理
4. **用户体验**：友好的操作提示和加载状态
5. **数据一致性**：严格的数据验证和业务规则检查

## 技术支持

如有问题或需要技术支持，请联系开发团队。
